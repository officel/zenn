---
title: "git ã® HEAD ãŒã‚ã‹ã‚‹ã¨ãƒ­ãƒ¼ã‚«ãƒ«ãƒ–ãƒ©ãƒ³ãƒã¯ãªãã¦ã‚‚ã©ã†ã«ã§ã‚‚ã§ãã‚‹è©±"
emoji: "ğŸ”Š"
type: "tech"  # tech or idea
topics: ["git","github"]
published: true
---

# tl;dr

- [gitã®ãƒ–ãƒ©ãƒ³ãƒåã¯å¾Œã‹ã‚‰æ±ºã‚ã‚‹](https://zenn.dev/nekoya/articles/d05a5a36851a5b) ã¨ã„ã†è¨˜äº‹ã‚’è¦‹ãŸ
- åŒåƒšã«ã‚‚ HEAD ã®ä½¿ã„æ–¹ãŒã„ã¾ã„ã¡ä¼ã‚ã£ã¦ãªã„
- ãƒ­ãƒ¼ã‚«ãƒ«ã ã‘ã§éŠã¶æ–¹æ³•ã‚‚ä¼ã‚ã£ã¦ãªã•ã’ï¼Ÿ
- ã‚·ã‚§ãƒ«ã§è¡¨ç¾ã—ã¦ã¿ãŸ
- git ã¯ HEAD ãŒã‚ã‹ã‚Œã°ãƒ­ãƒ¼ã‚«ãƒ«ãƒ–ãƒ©ãƒ³ãƒã¯è¦ã‚‰ãªã„ã—ã€ãƒ–ãƒ©ãƒ³ãƒåã®å¤‰æ›´ã¯ç°¡å˜ï¼ˆPRä½œæˆå¾Œã ã¨åˆ¥ã®PRã«ãªã‚‹ã‘ã©ï¼‰
- bash ãªã®ã§ã©ã“ã§ã‚‚å‹•ãã¯ãšã€‚ã€‚ã€‚

# ã‚·ã‚§ãƒ«å…¨éƒ¨

:::details ã‚³ãƒ¼ãƒ‰è‡ªä½“ã¯ã¾ã ãã‚“ãªã«å†åˆ©ç”¨æ€§ãŒé«˜ããªã„ï¼ˆåˆ¥ã«ä½ãã‚‚ãªã„ã‘ã©ï¼‰

```bash:git.sh
#!/bin/env bash

set -ue -o pipefail

export LC_ALL=C
export LC_TIME=C

# config_git ã§è¨­å®šã—ã¦ã„ã‚‹ alias ã‚’ä½¿ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹
shopt -s expand_aliases
source  ~/.config/bash/bash_aliases

timestamp=$(date +%Y%m%d%H%M%S)
readonly TEST_DIR=$(mktemp -dt "$(basename "${BASH_SOURCE}").$timestamp.XXXXX")/
readonly TEST_REPO="my-test"

set -v

# ä½œæ¥­ç”¨ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•
cd ${TEST_DIR}
pwd
ls -la

# ãƒªãƒã‚¸ãƒˆãƒªã‚’ä½œæˆï¼ˆä¸­èº«ã‚’èª¿ã¹ã‚‹ã®ã¯ä¸­ç´šè€…ã¸ã®é“ï¼‰
git init --bare ${TEST_REPO}.git
ls -la

# ãƒªãƒã‚¸ãƒˆãƒªã‚’ clone ã—ã¦ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«å…¥ã‚‹
git clone ${TEST_REPO}.git
ls -la
cd ${TEST_REPO}
pwd
ls -la

# config ã¨ alias ã‚’ã‚»ãƒƒãƒˆã€‚config_git ã‚’è¦‹ã¦ã­
set +v
git config user.name  "raki"
git config user.email "raki@example.com"
git config alias.co   "checkout"
git config alias.pr   "!git push origin HEAD:refs/heads/\$1 #"
git config alias.plog "log --pretty=format:'%C(yellow)%h %C(green)%cd %C(reset)%s %C(red)%d %C(cyan)[%an]' --date=format-local:'%t%Y/%m/%d %H:%M'  --all --graph"
set -v

# git log ã‚’è¦‹ã¦ã‚‚ç©ºï¼ˆã¾ã ä½•ã‚‚ã—ã¦ãªã„ã‹ã‚‰ã­ï¼‰
gp

# ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ push ã¾ã§
echo "1st" > README.md
ga README.md
gcv -m "feat: 1st"
gpr main
# æœ€åˆã ã‹ã‚‰ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ–ãƒ©ãƒ³ãƒã‚’ä½œæˆã—ã¦ã„ã‚‹ã“ã¨ã«æ³¨æ„
gp

# detached head ã§é‹ç”¨ã—ã‚„ã™ã„ã‚ˆã†ã« origin/HEAD ã‚’ã‚»ãƒƒãƒˆã™ã‚‹
git remote set-head origin main
gr
# fetch ã—ãªãŠã—ã¦ detach ã™ã‚‹ã€‚ãƒ­ãƒ¼ã‚«ãƒ«ã® main ãƒ–ãƒ©ãƒ³ãƒã¯ã‚‚ã†è¦ã‚‰ãªã„ã®ã§å‰Šé™¤
gb -d main
gp

# é€šå¸¸é‹ç”¨
# ã„ã¤ã§ã‚‚æœ€æ–°ã® HEAD(origin/main) ã‹ã‚‰ä½œæ¥­ã‚’å§‹ã‚ã‚‹
gr

echo "2nd" >> README.md
gdi
gau
gst
gcv -m"feat: 2nd"
gpr feat/2nd
gp
gr

# GitHub ãªã‚‰ PR ãŒä½œã‚Œã‚‹çŠ¶æ…‹ã€‚ãƒ­ãƒ¼ã‚«ãƒ«ã§ã¯ã§ããªã„ã®ã§ãƒãƒ¼ã‚¸å‡¦ç†
g merge --ff origin/feat/2nd
gp
gpr main
g push origin :feat/2nd
gp

# ã‚‚ã£ã¨ãƒ–ãƒ©ãƒ³ãƒã£ã½ã„ä½œæ¥­
gr
echo "3rd" >> README.md
gau
gcv -m"feat: 3rd"
echo "4th" >> README.md
gau
gcv -m"feat: 4th"
gpr feat/3to4
gr
# --no-ff ã§ merge commit ã‚’ä½œæˆã™ã‚‹
g merge --no-ff --no-edit origin/feat/3to4
gpr main
gr

# squash ã—ã¦ã¿ã‚‹ï¼ˆrebaseã˜ã‚ƒãªã„ã‚„ã‚Šæ–¹ï¼‰
gr
echo "5th" >> README.md
gau
gcv -m"feat: 5th"
echo "6th" >> README.md
gau
gcv -m"feat: 6th"
gpr feat/5to6
## å¾Œã§ä½¿ã†
HASH_6th=$(git show --format='%h' --no-patch)

## è¤‡æ•°ã‚³ãƒŸãƒƒãƒˆã®ãƒ–ãƒ©ãƒ³ãƒã¨ã¯åˆ¥ã®ç©ºãƒ–ãƒ©ãƒ³ãƒã‚’ä½œã£ã¦ squash ã—ã¦ push
gr
g merge --squash origin/feat/5to6
gcv -m"test: squash merge. include 5to6"
gpr feat/for_squash/5to6
## squash ã—ãŸãƒ–ãƒ©ãƒ³ãƒã‚’ ff ãƒãƒ¼ã‚¸ã™ã‚‹
gr
g merge --ff --no-edit origin/feat/for_squash/5to6
gpr main
gr
## ãƒ–ãƒ©ãƒ³ãƒã‚’æƒé™¤ã—ã¦è¦‹ã‚„ã™ã
g push origin :feat/3to4
g push origin :feat/5to6
g push origin :feat/for_squash/5to6
gr


# ãƒ–ãƒ©ãƒ³ãƒåã®å¤‰æ›´
echo "7th" >> README.md
gau
gcv -m"feat: 7th"
gpr feat/5to6
## å¾Œã§ä½¿ã†
HASH_7th=$(git show --format='%h' --no-patch)
gr
## ãƒ–ãƒ©ãƒ³ãƒåé–“é•ãˆã¦ã‚‹ï¼ˆç›´ã•ãªã„ã¨ï¼‰
g co ${HASH_7th}
gpr feat/7th
g push origin :feat/5to6
gr
## ã‚ã‚ã¦ãšã•ã‚ãŒãšå¯¾è±¡ã®ã‚³ãƒŸãƒƒãƒˆã§æ–°ã—ã„ãƒ–ãƒ©ãƒ³ãƒåã‚’pushã—ã¦å¤ã„ã»ã†ã‚’æ¶ˆã›ã°ã„ã„ã ã‘


# ï¼ˆãŠã¾ã‘ï¼‰squash ã—ã¦ã‚‚ãƒãƒƒã‚·ãƒ¥ãŒã‚ã‹ã‚Œã°æˆ»ã›ã‚‹ã‚ˆ
g co ${HASH_6th}
gp

# ï¼ˆãŠã¾ã‘ï¼‰README.md
gr
cat README.md

# æƒé™¤
rm -fr ${TEST_DIR}

```

:::

# alias

## bash ã® alias for git

- [config_bash/bash_aliases at main Â· officel/config_bash](https://github.com/officel/config_bash/blob/main/bash_aliases)
- è‡ªå‰ã§ã‚»ãƒƒãƒˆã™ã‚‹ã‹èª­ã¿æ›¿ãˆã¦
- ã¶ã£ã¡ã‚ƒã‘æ™®æ®µã“ã‚Œã§äº‹è¶³ã‚Šã¦ã‚‹

```bash
$ type g gr gst gdi ga gau gcv gpr gp
g is aliased to `git'
gr is aliased to `git fetch --prune --all && git checkout origin/HEAD && git plog -10 && git status'
gst is aliased to `git status --short --branch'
gdi is aliased to `git diff'
ga is aliased to `git add'
gau is aliased to `git add -u'
gcv is aliased to `git commit -v'
gpr is aliased to `git pr'
gp is aliased to `git plog -10'
```

## git alias

- [officel/config_git: .config/git](https://github.com/officel/config_git)
- è‡ªå‰ã§ã‚»ãƒƒãƒˆã™ã‚‹ã‹èª­ã¿æ›¿ãˆã¦
- switch ã‚ã£ãŸã«ä½¿ã‚ãªã„ï½—
- plog ã¨ pr ã¯ bash alias ã¨ã‚»ãƒƒãƒˆé‹ç”¨ãªã®ã§æ³¨æ„

```bash
$ git alias
alias    => !git config --get-regexp 'alias\.' | sed 's/alias\.\([^ ]*\) \(.*\)/\1\      => \2/' | sort
c        => commit
cancel   => reset --soft HEAD^
co       => checkout
coo      => checkout origin/HEAD
deleted  => log --diff-filter=D --summary
load     => stash pop
plog     => log --pretty=format:'%C(yellow)%h %C(green)%cd %C(reset)%s %C(red)%d %C(cyan)[%an]' --date=format-local:'%t%Y/%m/%d %H:%M'  --all --graph
pr       => !git push origin HEAD:refs/heads/$1 #
restoring        => !git checkout $(git rev-list -n 1 HEAD -- ${1:-none})~1 --
save     => stash save
sw       => switch
swo      => switch -d origin/HEAD
```

# å®Ÿè¡Œçµæœã‚’ã¡ã‚‡ã£ã¨æ•´å½¢ã—ã¤ã¤èª¬æ˜

## ä½œæ¥­ç”¨ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•

```bash
$ cd ${TEST_DIR}
$ pwd
/tmp/git.sh.20240803071702.91o28

$ ls -la
total 20
drwx------  2 raki raki  4096 Aug  3 07:17 .
drwxrwxrwt 21 root root 16384 Aug  3 07:17 ..
```

- ã©ã“ã§ã‚‚ã„ã„ã‘ã©ç©ºã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ç”¨æ„ã™ã‚‹
- bash ã® mktemp() ã§ãƒãƒƒãƒ†ã‚£ãƒ³ã‚°ã—ãªã„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½¿ç”¨ã™ã‚‹ã¨æ¥½

## ãƒ­ãƒ¼ã‚«ãƒ«ã§éŠã¹ã‚‹ãƒªãƒã‚¸ãƒˆãƒªã‚’ä½œæˆï¼ˆä¸­èº«ã‚’èª¿ã¹ã‚‹ã®ã¯ä¸­ç´šè€…ã¸ã®é“ï¼‰

```bash
$ git init --bare ${TEST_REPO}.git
Initialized empty Git repository in /tmp/git.sh.20240803071702.91o28/my-test.git/

$ ls -la
total 24
drwx------  3 raki raki  4096 Aug  3 07:17 .
drwxrwxrwt 21 root root 16384 Aug  3 07:17 ..
drwxr-xr-x  7 raki raki  4096 Aug  3 07:17 my-test.git
```

- `--bare` ã§ãƒ™ã‚¢ãƒªãƒã‚¸ãƒˆãƒªãŒä½œæˆã§ãã‚‹ã€‚è¦ã¯ GitHub ã§æ–°ã—ã„ãƒªãƒã‚¸ãƒˆãƒªã‚’ä½œã£ãŸã®ã¨åŒã˜
- æ‹¡å¼µå­ `.git` ã¯æ…£ç¿’çš„ãªã‚‚ã®ï¼ˆãƒ™ã‚¢ãƒªãƒã‚¸ãƒˆãƒªã«ã¤ã‘ã‚‹ï¼‰

## ãƒªãƒã‚¸ãƒˆãƒªã‚’ clone ã—ã¦ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«å…¥ã‚‹

```bash
$ git clone ${TEST_REPO}.git
Cloning into 'my-test'...
warning: You appear to have cloned an empty repository.
done.

$ ls -la
total 28
drwx------  4 raki raki  4096 Aug  3 07:17 .
drwxrwxrwt 21 root root 16384 Aug  3 07:17 ..
drwxr-xr-x  3 raki raki  4096 Aug  3 07:17 my-test
drwxr-xr-x  7 raki raki  4096 Aug  3 07:17 my-test.git

$ cd ${TEST_REPO}
$ pwd
/tmp/git.sh.20240803071702.91o28/my-test
$ ls -la
total 12
drwxr-xr-x 3 raki raki 4096 Aug  3 07:17 .
drwx------ 4 raki raki 4096 Aug  3 07:17 ..
drwxr-xr-x 7 raki raki 4096 Aug  3 07:17 .git
```

- https ã§ã‚‚ ssh ã§ã‚‚ãªãå˜ã«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æŒ‡å®šã—ã¦ clone ã—ã¦ã„ã‚‹ã ã‘
- `my-test.git`ï¼ˆãƒ™ã‚¢ãƒªãƒã‚¸ãƒˆãƒªï¼‰ã¨`my-test`ï¼ˆcloneã—ãŸãƒªãƒã‚¸ãƒˆãƒªï¼‰ã®é•ã„ã«ã¤ã„ã¦ã¡ã‚ƒã‚“ã¨ç†è§£ã—ã¦ãŠãã“ã¨

## config ã¨ alias ã‚’ã‚»ãƒƒãƒˆ

```bash
$ git config user.name  "raki"
$ git config user.email "raki@example.com"
$ git config alias.co   "checkout"
$ git config alias.pr   "!git push origin HEAD:refs/heads/\$1 #"
$ git config alias.plog "log --pretty=format:'%C(yellow)%h %C(green)%cd %C(reset)%s %C(red)%d %C(cyan)[%an]' --date=format-local:'%t%Y/%m/%d %H:%M'  --all --graph"

# git log ã‚’è¦‹ã¦ã‚‚ç©ºï¼ˆã¾ã ä½•ã‚‚ã—ã¦ãªã„ã‹ã‚‰ã­ï¼‰
$ gp
```

- git config ã¯ã™ã§ã«è¨­å®šæ¸ˆã¿ãªã‚‰ã—ãªãã¦ã‚‚å¤§ä¸ˆå¤«
- ã‚·ã‚§ãƒ«ç”¨ã«è¨˜è¼‰ã—ãŸã ã‘

## ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ push ã—ã¦æœ€åˆã®æº–å‚™å®Œäº†ã¾ã§

```bash
$ echo "1st" > README.md
$ ga README.md

$ gcv -m "feat: 1st"
[main (root-commit) 519d0c0] feat: 1st
 1 file changed, 1 insertion(+)
 create mode 100644 README.md

$ gpr main
To /tmp/git.sh.20240803071702.91o28/my-test.git
 * [new branch]      HEAD -> main

## æœ€åˆã ã‹ã‚‰ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ–ãƒ©ãƒ³ãƒã‚’ä½œæˆã—ã¦ã„ã‚‹ã“ã¨ã«æ³¨æ„

$ gp
* 519d0c0 	2024/08/03 07:17 feat: 1st  (HEAD -> main, origin/main) [raki]

## detached head ã§é‹ç”¨ã—ã‚„ã™ã„ã‚ˆã†ã« origin/HEAD ã‚’ã‚»ãƒƒãƒˆã™ã‚‹
$ git remote set-head origin main

## fetch ã—ãªãŠã—ã¦ detach ã™ã‚‹ã€‚ãƒ­ãƒ¼ã‚«ãƒ«ã® main ãƒ–ãƒ©ãƒ³ãƒã¯ã‚‚ã†è¦ã‚‰ãªã„ã®ã§å‰Šé™¤
$ gr
HEAD is now at 519d0c0 feat: 1st
* 519d0c0 	2024/08/03 07:17 feat: 1st  (HEAD, origin/main, origin/HEAD, main) [raki]
HEAD detached at origin/main
nothing to commit, working tree clean

$ gb -d main
Deleted branch main (was 519d0c0).

$ gp
* 519d0c0 	2024/08/03 07:17 feat: 1st  (HEAD, origin/main, origin/HEAD) [raki]
```

## é€šå¸¸é‹ç”¨

```bash
# ã„ã¤ã§ã‚‚æœ€æ–°ã® HEAD(origin/main) ã‹ã‚‰ä½œæ¥­ã‚’å§‹ã‚ã‚‹
$ gr
HEAD is now at 519d0c0 feat: 1st
* 519d0c0 	2024/08/03 07:17 feat: 1st  (HEAD, origin/main, origin/HEAD) [raki]
HEAD detached at origin/main
nothing to commit, working tree clean

$ echo "2nd" >> README.md
$ gdi
diff --git a/README.md b/README.md
index 2a5d015..c8cac97 100644
--- a/README.md
+++ b/README.md
@@ -1 +1,2 @@
 1st
+2nd

$ gau
$ gst
## HEAD (no branch)
M  README.md

$ gcv -m"feat: 2nd"
[detached HEAD c696723] feat: 2nd
 1 file changed, 1 insertion(+)

$ gpr feat/2nd
To /tmp/git.sh.20240803071702.91o28/my-test.git
 * [new branch]      HEAD -> feat/2nd

$ gp
* c696723 	2024/08/03 07:17 feat: 2nd  (HEAD, origin/feat/2nd) [raki]
* 519d0c0 	2024/08/03 07:17 feat: 1st  (origin/main, origin/HEAD) [raki]

$ gr
Previous HEAD position was c696723 feat: 2nd
HEAD is now at 519d0c0 feat: 1st
* c696723 	2024/08/03 07:17 feat: 2nd  (origin/feat/2nd) [raki]
* 519d0c0 	2024/08/03 07:17 feat: 1st  (HEAD, origin/main, origin/HEAD) [raki]
HEAD detached at origin/main
nothing to commit, working tree clean

# GitHub ãªã‚‰ PR ãŒä½œã‚Œã‚‹çŠ¶æ…‹ã€‚ãƒ­ãƒ¼ã‚«ãƒ«ã§ã¯ã§ããªã„ã®ã§ãƒãƒ¼ã‚¸å‡¦ç†
$ g merge --ff origin/feat/2nd
Updating 519d0c0..c696723
Fast-forward
 README.md | 1 +
 1 file changed, 1 insertion(+)

$ gp
* c696723 	2024/08/03 07:17 feat: 2nd  (HEAD, origin/feat/2nd) [raki]
* 519d0c0 	2024/08/03 07:17 feat: 1st  (origin/main, origin/HEAD) [raki]

$ gpr main
To /tmp/git.sh.20240803071702.91o28/my-test.git
   519d0c0..c696723  HEAD -> main
$ g push origin :feat/2nd
To /tmp/git.sh.20240803071702.91o28/my-test.git
 - [deleted]         feat/2nd
$ gp
* c696723 	2024/08/03 07:17 feat: 2nd  (HEAD, origin/main, origin/HEAD) [raki]
* 519d0c0 	2024/08/03 07:17 feat: 1st  [raki]
```

- HEAD ã®å‹•ãã«æ³¨ç›®
- `origin/xxx` ã¯ãƒªãƒ¢ãƒ¼ãƒˆãƒ–ãƒ©ãƒ³ãƒã€ãªã®ã¯è¨€ã†ã¾ã§ã‚‚ãªã„ã­ï¼Ÿ
- `gp` ã¯ã„ã¤ã§ã‚‚ä½•å›ã§ã‚‚æ‰“ã£ã¦ã‚ˆã—
- `gr` ã¯ä½œæ¥­é–‹å§‹æ™‚ã«ã„ã¤ã§ã‚‚æ‰“ã£ã¦ã‚ˆã—

## ã‚‚ã£ã¨ãƒ–ãƒ©ãƒ³ãƒã£ã½ã„ä½œæ¥­

```bash
$ gr
HEAD is now at c696723 feat: 2nd
* c696723 	2024/08/03 07:17 feat: 2nd  (HEAD, origin/main, origin/HEAD) [raki]
* 519d0c0 	2024/08/03 07:17 feat: 1st  [raki]
HEAD detached from 519d0c0
nothing to commit, working tree clean

$ echo "3rd" >> README.md
$ gau
$ gcv -m"feat: 3rd"
[detached HEAD 2c53d77] feat: 3rd
 1 file changed, 1 insertion(+)

$ echo "4th" >> README.md
$ gau
$ gcv -m"feat: 4th"
[detached HEAD 414dafc] feat: 4th
 1 file changed, 1 insertion(+)
$ gpr feat/3to4
To /tmp/git.sh.20240803071702.91o28/my-test.git
 * [new branch]      HEAD -> feat/3to4

$ gr
Previous HEAD position was 414dafc feat: 4th
HEAD is now at c696723 feat: 2nd
* 414dafc 	2024/08/03 07:17 feat: 4th  (origin/feat/3to4) [raki]
* 2c53d77 	2024/08/03 07:17 feat: 3rd  [raki]
* c696723 	2024/08/03 07:17 feat: 2nd  (HEAD, origin/main, origin/HEAD) [raki]
* 519d0c0 	2024/08/03 07:17 feat: 1st  [raki]
HEAD detached at origin/main
nothing to commit, working tree clean

# --no-ff ã§ merge commit ã‚’ä½œæˆã™ã‚‹
$ g merge --no-ff --no-edit origin/feat/3to4
Merge made by the 'ort' strategy.
 README.md | 2 ++
 1 file changed, 2 insertions(+)

$ gpr main
To /tmp/git.sh.20240803071702.91o28/my-test.git
   c696723..117fe4a  HEAD -> main

$ gr
HEAD is now at 117fe4a Merge remote-tracking branch 'origin/feat/3to4' into HEAD
*   117fe4a 	2024/08/03 07:17 Merge remote-tracking branch 'origin/feat/3to4' into HEAD  (HEAD, origin/main, origin/HEAD) [raki]
|\
| * 414dafc 	2024/08/03 07:17 feat: 4th  (origin/feat/3to4) [raki]
| * 2c53d77 	2024/08/03 07:17 feat: 3rd  [raki]
|/
* c696723 	2024/08/03 07:17 feat: 2nd  [raki]
* 519d0c0 	2024/08/03 07:17 feat: 1st  [raki]HEAD detached from c696723
nothing to commit, working tree clean
```

## squash ã—ã¦ã¿ã‚‹ï¼ˆrebaseã˜ã‚ƒãªã„ã‚„ã‚Šæ–¹ï¼‰

```bash
$ gr
HEAD is now at 117fe4a Merge remote-tracking branch 'origin/feat/3to4' into HEAD
*   117fe4a 	2024/08/03 07:17 Merge remote-tracking branch 'origin/feat/3to4' into HEAD  (HEAD, origin/main, origin/HEAD) [raki]
|\
| * 414dafc 	2024/08/03 07:17 feat: 4th  (origin/feat/3to4) [raki]
| * 2c53d77 	2024/08/03 07:17 feat: 3rd  [raki]
|/
* c696723 	2024/08/03 07:17 feat: 2nd  [raki]
* 519d0c0 	2024/08/03 07:17 feat: 1st  [raki]
HEAD detached from c696723
nothing to commit, working tree clean

$ echo "5th" >> README.md
$ gau
$ gcv -m"feat: 5th"
[detached HEAD 2dd9481] feat: 5th
 1 file changed, 1 insertion(+)

$ echo "6th" >> README.md
$ gau
$ gcv -m"feat: 6th"
[detached HEAD 0420ae9] feat: 6th
 1 file changed, 1 insertion(+)

$ gpr feat/5to6
To /tmp/git.sh.20240803071702.91o28/my-test.git
 * [new branch]      HEAD -> feat/5to6
## å¾Œã§ä½¿ã†
$ HASH_6th=$(git show --format='%h' --no-patch)

## è¤‡æ•°ã‚³ãƒŸãƒƒãƒˆã®ãƒ–ãƒ©ãƒ³ãƒã¨ã¯åˆ¥ã®ç©ºãƒ–ãƒ©ãƒ³ãƒã‚’ä½œã£ã¦ squash ã—ã¦ push
$ gr
Previous HEAD position was 0420ae9 feat: 6th
HEAD is now at 117fe4a Merge remote-tracking branch 'origin/feat/3to4' into HEAD
* 0420ae9 	2024/08/03 07:17 feat: 6th  (origin/feat/5to6) [raki]
* 2dd9481 	2024/08/03 07:17 feat: 5th  [raki]
*   117fe4a 	2024/08/03 07:17 Merge remote-tracking branch 'origin/feat/3to4' into HEAD  (HEAD, origin/main, origin/HEAD) [raki]
|\
| * 414dafc 	2024/08/03 07:17 feat: 4th  (origin/feat/3to4) [raki]
| * 2c53d77 	2024/08/03 07:17 feat: 3rd  [raki]
|/
* c696723 	2024/08/03 07:17 feat: 2nd  [raki]
* 519d0c0 	2024/08/03 07:17 feat: 1st  [raki]
HEAD detached at origin/main
nothing to commit, working tree clean

$ g merge --squash origin/feat/5to6
Updating 117fe4a..0420ae9
Fast-forward
Squash commit -- not updating HEAD
 README.md | 2 ++
 1 file changed, 2 insertions(+)

$ gcv -m"test: squash merge. include 5to6"
[detached HEAD 536bb08] test: squash merge. include 5to6
 1 file changed, 2 insertions(+)

$ gpr feat/for_squash/5to6
To /tmp/git.sh.20240803071702.91o28/my-test.git
 * [new branch]      HEAD -> feat/for_squash/5to6

## squash ã—ãŸãƒ–ãƒ©ãƒ³ãƒã‚’ ff ãƒãƒ¼ã‚¸ã™ã‚‹
$ gr
Previous HEAD position was 536bb08 test: squash merge. include 5to6
HEAD is now at 117fe4a Merge remote-tracking branch 'origin/feat/3to4' into HEAD
* 536bb08 	2024/08/03 07:17 test: squash merge. include 5to6  (origin/feat/for_squash/5to6) [raki]
| * 0420ae9 	2024/08/03 07:17 feat: 6th  (origin/feat/5to6) [raki]
| * 2dd9481 	2024/08/03 07:17 feat: 5th  [raki]
|/
*   117fe4a 	2024/08/03 07:17 Merge remote-tracking branch 'origin/feat/3to4' into HEAD  (HEAD, origin/main, origin/HEAD) [raki]
|\
| * 414dafc 	2024/08/03 07:17 feat: 4th  (origin/feat/3to4) [raki]
| * 2c53d77 	2024/08/03 07:17 feat: 3rd  [raki]
|/
* c696723 	2024/08/03 07:17 feat: 2nd  [raki]
* 519d0c0 	2024/08/03 07:17 feat: 1st  [raki]
HEAD detached at origin/main
nothing to commit, working tree clean

$ g merge --ff --no-edit origin/feat/for_squash/5to6
Updating 117fe4a..536bb08
Fast-forward
 README.md | 2 ++
 1 file changed, 2 insertions(+)

$ gpr main
To /tmp/git.sh.20240803071702.91o28/my-test.git
   117fe4a..536bb08  HEAD -> main

$ gr
HEAD is now at 536bb08 test: squash merge. include 5to6
* 536bb08 	2024/08/03 07:17 test: squash merge. include 5to6  (HEAD, origin/main, origin/feat/for_squash/5to6, origin/HEAD) [raki]
| * 0420ae9 	2024/08/03 07:17 feat: 6th  (origin/feat/5to6) [raki]
| * 2dd9481 	2024/08/03 07:17 feat: 5th  [raki]
|/
*   117fe4a 	2024/08/03 07:17 Merge remote-tracking branch 'origin/feat/3to4' into HEAD  [raki]
|\
| * 414dafc 	2024/08/03 07:17 feat: 4th  (origin/feat/3to4) [raki]
| * 2c53d77 	2024/08/03 07:17 feat: 3rd  [raki]
|/
* c696723 	2024/08/03 07:17 feat: 2nd  [raki]
* 519d0c0 	2024/08/03 07:17 feat: 1st  [raki]
HEAD detached from 117fe4a
nothing to commit, working tree clean

## ãƒ–ãƒ©ãƒ³ãƒã‚’æƒé™¤ã—ã¦è¦‹ã‚„ã™ã
$ g push origin :feat/3to4
To /tmp/git.sh.20240803071702.91o28/my-test.git
 - [deleted]         feat/3to4

$ g push origin :feat/5to6
To /tmp/git.sh.20240803071702.91o28/my-test.git
 - [deleted]         feat/5to6

$ g push origin :feat/for_squash/5to6
To /tmp/git.sh.20240803071702.91o28/my-test.git
 - [deleted]         feat/for_squash/5to6

$ gr
HEAD is now at 536bb08 test: squash merge. include 5to6
* 536bb08 	2024/08/03 07:17 test: squash merge. include 5to6  (HEAD, origin/main, origin/HEAD) [raki]
*   117fe4a 	2024/08/03 07:17 Merge remote-tracking branch 'origin/feat/3to4' into HEAD  [raki]
|\
| * 414dafc 	2024/08/03 07:17 feat: 4th  [raki]
| * 2c53d77 	2024/08/03 07:17 feat: 3rd  [raki]
|/
* c696723 	2024/08/03 07:17 feat: 2nd  [raki]
* 519d0c0 	2024/08/03 07:17 feat: 1st  [raki]
HEAD detached from 117fe4a
nothing to commit, working tree clean
```

- `--ff` ã¨ `--squash` ã®é•ã„
- ã‚³ãƒŸãƒƒãƒˆãƒãƒƒã‚·ãƒ¥ã®å¤‰åŒ–
- é•·ã„ã‘ã©ç†è§£ã®ãŸã‚ã«ãƒ­ã‚°ã‚’å¤šãå‡ºåŠ›ã—ã¦ã„ã‚‹ã ã‘
- è¦ã¯ `squash` ã—ãŸã‚³ãƒŸãƒƒãƒˆã‚’ä½œã£ã¦ `--ff` ã™ã‚‹ã“ã¨ã§ã€GitHub ä¸Šã§ã® squash merge ã¨åŒã˜ã«ãªã‚‹

## ãƒ–ãƒ©ãƒ³ãƒåã®å¤‰æ›´

```bash
$ echo "7th" >> README.md
$ gau
$ gcv -m"feat: 7th"
[detached HEAD 880b0ef] feat: 7th
 1 file changed, 1 insertion(+)
$ gpr feat/5to6
To /tmp/git.sh.20240803071702.91o28/my-test.git
 * [new branch]      HEAD -> feat/5to6
## å¾Œã§ä½¿ã†
$ HASH_7th=$(git show --format='%h' --no-patch)

$ gr
Previous HEAD position was 880b0ef feat: 7th
HEAD is now at 536bb08 test: squash merge. include 5to6
* 880b0ef 	2024/08/03 07:17 feat: 7th  (origin/feat/5to6) [raki]
* 536bb08 	2024/08/03 07:17 test: squash merge. include 5to6  (HEAD, origin/main, origin/HEAD) [raki]
*   117fe4a 	2024/08/03 07:17 Merge remote-tracking branch 'origin/feat/3to4' into HEAD  [raki]
|\
| * 414dafc 	2024/08/03 07:17 feat: 4th  [raki]
| * 2c53d77 	2024/08/03 07:17 feat: 3rd  [raki]
|/
* c696723 	2024/08/03 07:17 feat: 2nd  [raki]
* 519d0c0 	2024/08/03 07:17 feat: 1st  [raki]
HEAD detached at origin/main
nothing to commit, working tree clean

## ãƒ–ãƒ©ãƒ³ãƒåé–“é•ãˆã¦ã‚‹ï¼ˆç›´ã•ãªã„ã¨ï¼‰
$ g co ${HASH_7th}
Previous HEAD position was 536bb08 test: squash merge. include 5to6
HEAD is now at 880b0ef feat: 7th

## åŒã˜ã‚³ãƒŸãƒƒãƒˆã«æ–°ã—ã„ãƒ–ãƒ©ãƒ³ãƒåã‚’ã¤ã‘ã‚‹
$ gpr feat/7th
To /tmp/git.sh.20240803071702.91o28/my-test.git
 * [new branch]      HEAD -> feat/7th

## é–“é•ã£ãŸãƒ–ãƒ©ãƒ³ãƒåã¯æ¶ˆã™ï¼ˆGitHub ã§ PR ã‚’ä½œæˆæ¸ˆã¿ã ã¨ close ã•ã‚Œã‚‹ã€‚æ–°ã—ã„ãƒ–ãƒ©ãƒ³ãƒåã§åˆ¥ã® PR ã‚’ä½œã‚‹å¿…è¦ãŒã‚ã‚‹ï¼‰
$ g push origin :feat/5to6
To /tmp/git.sh.20240803071702.91o28/my-test.git
 - [deleted]         feat/5to6

$ gr
Previous HEAD position was 880b0ef feat: 7th
HEAD is now at 536bb08 test: squash merge. include 5to6
* 880b0ef 	2024/08/03 07:17 feat: 7th  (origin/feat/7th) [raki]
* 536bb08 	2024/08/03 07:17 test: squash merge. include 5to6  (HEAD, origin/main, origin/HEAD) [raki]
*   117fe4a 	2024/08/03 07:17 Merge remote-tracking branch 'origin/feat/3to4' into HEAD  [raki]
|\
| * 414dafc 	2024/08/03 07:17 feat: 4th  [raki]
| * 2c53d77 	2024/08/03 07:17 feat: 3rd  [raki]
|/
* c696723 	2024/08/03 07:17 feat: 2nd  [raki]
* 519d0c0 	2024/08/03 07:17 feat: 1st  [raki]HEAD detached at origin/main
nothing to commit, working tree clean
```

- ã‚ã‚ã¦ãšã•ã‚ãŒãšå¯¾è±¡ã®ã‚³ãƒŸãƒƒãƒˆã§æ–°ã—ã„ãƒ–ãƒ©ãƒ³ãƒåã‚’pushã—ã¦å¤ã„ã»ã†ã‚’æ¶ˆã›ã°ã„ã„ã ã‘

## ï¼ˆãŠã¾ã‘ï¼‰squash ã—ã¦ã‚‚ãƒãƒƒã‚·ãƒ¥ãŒã‚ã‹ã‚Œã°æˆ»ã›ã‚‹ã‚ˆ

```bash
## ã¨ã£ã¦ãŠã„ãŸã‚³ãƒŸãƒƒãƒˆãƒãƒƒã‚·ãƒ¥ã§ checkout
g co ${HASH_6th}
Previous HEAD position was 536bb08 test: squash merge. include 5to6
HEAD is now at 0420ae9 feat: 6th

$ gp
* 880b0ef 	2024/08/03 07:17 feat: 7th  (origin/feat/7th) [raki]
* 536bb08 	2024/08/03 07:17 test: squash merge. include 5to6  (origin/main, origin/HEAD) [raki]
| * 0420ae9 	2024/08/03 07:17 feat: 6th  (HEAD) [raki]
| * 2dd9481 	2024/08/03 07:17 feat: 5th  [raki]
|/
*   117fe4a 	2024/08/03 07:17 Merge remote-tracking branch 'origin/feat/3to4' into HEAD  [raki]
|\
| * 414dafc 	2024/08/03 07:17 feat: 4th  [raki]
| * 2c53d77 	2024/08/03 07:17 feat: 3rd  [raki]
|/
* c696723 	2024/08/03 07:17 feat: 2nd  [raki]
* 519d0c0 	2024/08/03 07:17 feat: 1st  [raki]
```

- git ref ã®ä½¿ã„æ–¹ã¯ä¸­ç´šè€…å‘ã‘
- ãŸã ã¾ãå¸¸ã«ã‚³ãƒŸãƒƒãƒˆãƒãƒƒã‚·ãƒ¥ã§ HEAD ã®ä½ç½®ã‚’è€ƒæ…®ã—ã¦ã„ã‚Œã°ãã‚“ãªã«é›£ã—ã„ã“ã¨è¨€ã£ã¦ãªã„

## ï¼ˆãŠã¾ã‘ï¼‰README.md

```bash
$ gr
Warning: you are leaving 2 commits behind, not connected to
any of your branches:

  0420ae9 feat: 6th
  2dd9481 feat: 5th

HEAD is now at 536bb08 test: squash merge. include 5to6
* 880b0ef 	2024/08/03 07:17 feat: 7th  (origin/feat/7th) [raki]
* 536bb08 	2024/08/03 07:17 test: squash merge. include 5to6  (HEAD, origin/main, origin/HEAD) [raki]
*   117fe4a 	2024/08/03 07:17 Merge remote-tracking branch 'origin/feat/3to4' into HEAD  [raki]
|\
| * 414dafc 	2024/08/03 07:17 feat: 4th  [raki]
| * 2c53d77 	2024/08/03 07:17 feat: 3rd  [raki]
|/
* c696723 	2024/08/03 07:17 feat: 2nd  [raki]
* 519d0c0 	2024/08/03 07:17 feat: 1st  [raki]
HEAD detached at origin/main
nothing to commit, working tree clean

$ cat README.md
1st
2nd
3rd
4th
5th
6th
```

# æœ€å¾Œã«

- [gitã§ãƒ­ãƒ¼ã‚«ãƒ«ãƒ–ãƒ©ãƒ³ãƒã«masterãªã‚“ã¦ï¼ˆæ™®é€šã¯ï¼‰è¦ã‚Šã¾ã›ã‚“ #Git - Qiita](https://qiita.com/igrep/items/f2e927a31e826766b8c0) ã‚’è¦‹ã¦ã‹ã‚‰ãšã£ã¨ãƒ­ãƒ¼ã‚«ãƒ«ãƒ–ãƒ©ãƒ³ãƒãƒ¬ã‚¹ãªç”Ÿæ´»
- push ã—ãªã„ã§ãƒ­ãƒ¼ã‚«ãƒ«ã§è¤‡æ•°ã®ä½œæ¥­ã‚’ã—ãŸã„æ™‚ã¯ä½œã‚‹ã€ã‹ã‚‚ã—ã‚Œãªã„ï¼ˆçŠ¶æ³ã«ã‚ˆã‚‹ã‘ã©ã‚ã‚“ã¾ã‚Šãªã„ï¼‰
- å¸¸ã« `gr` ã—ã¦ `gp` ã§ãƒ­ã‚°ã‚’è¦‹ã¦ã‚‹ã¨ã€ã‚³ãƒŸãƒƒãƒˆã‚¿ã‚¤ãƒˆãƒ«ãŒã²ã©ã„ã‚„ã¤ã¨ã‹è¨±ã›ãªããªã‚‹
- ãƒ–ãƒ©ãƒ³ãƒãŒæ±šã„ã®ã¨ã‹è€ãˆã‚‰ã‚Œãªã„
- rebase ã¨ã‹ squash ã¨ã‹ amend ã¨ã‹ã€ã‚³ãƒŸãƒƒãƒˆã‚’ãã‚Œã„ã«ã™ã‚‹ä½œæ¥­ã¯é¢å€’ãã•ã„ã‚“ã˜ã‚ƒãªãã¦çŸ¥ã‚‰ãªã„ã ã‘
- ãªã‚“ã ã‹æ–¹å‘ãŒãšã‚Œã¡ã‚ƒã£ãŸã‘ã©ã€HEAD ã‚’ç†è§£ã—ã¦ã„ã‚Œã°ã ã„ãŸã„ãªã‚“ã¨ã‹ãªã‚Šã¾ã™
- å¾Œã§å°‘ã—æ›¸ãç›´ã™ã‹ã‚‚
