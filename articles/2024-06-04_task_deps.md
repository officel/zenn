---
title: "task ã§ dependency ã«è¿·ã£ãŸè©±"
emoji: "ğŸ¤”"
type: "tech"
topics: ["task","taskfile.dev"]
published: true
---

# tl;dr

- [Task](https://taskfile.dev/) ã§ã‚¿ã‚¹ã‚¯ã®ä¾å­˜é–¢ä¿‚ã‚’å‡¦ç†ã—ã‚ˆã†ã¨ã—ã¦è¿·ã£ãŸ
- [API Reference](https://taskfile.dev/api/#dependency) ã‚’å…ˆã«è¦‹ã¦ã—ã¾ã£ãŸã›ã„
- [Usage](https://taskfile.dev/usage/#task-dependencies) ã«ã¡ã‚ƒã‚“ã¨æ›¸ã„ã¦ã‚ã£ãŸ
- deps ã‚’ä½¿ã†ã¨ä¸¦åˆ—ã«å®Ÿè¡Œã•ã‚Œã‚‹
- é †åºã‚ˆãå®Ÿè¡Œã•ã›ã‚‹å ´åˆã¯ cmds ã§ task ã‚’æŒ‡å®šã™ã‚‹

# ä¾å­˜é–¢ä¿‚ã‚’å‡¦ç†ã—ãŸã„ï¼ˆå¤±æ•—ã®è»Œè·¡ï¼‰

- ãªã‚“ã‚‰ã‹ã®ã‚¿ã‚¹ã‚¯ã‚’è¤‡æ•°æ›¸ã‘ã°ã€ã¾ã¨ã‚ã¦å®Ÿè¡Œã—ãŸã„ã®ã¯äººã®æ€§ï¼ˆã•ãŒï¼‰
- æ–°ã—ã„ãƒ„ãƒ¼ãƒ«ã§éŠã¶æ™‚ã¯ã„ã‚ã„ã‚è©¦ã™ã¤ã„ã§ã«ã€æœ€å¾Œã¯ã¾ã¨ã‚ã¦å‡ºåŠ›ã—ãŸã„
- ansible ã§ play ã‚„ role ã‚’æ›¸ãæ„Ÿè¦šã§ä¾å­˜é–¢ä¿‚ã‚’å‡¦ç†ã™ã‚Œã°è¦‹ã‚„ã™ãã§ããã†
- [ä¾å­˜é–¢ä¿‚](https://taskfile.dev/api/#dependency) ã‚’è¦‹ãŸã‚‰ãã‚Œã£ã½ã„ã‹ã‚‰æ›¸ã„ã¦ã¿ãŸ
- æœŸå¾…ã¨é•ã†ğŸ˜¨

```bash
cat Taskfile.yml
# yaml-language-server: $schema=https://taskfile.dev/schema.json
# https://taskfile.dev/

version: '3'

tasks:
  test_all:
    desc: all test tasks
    aliases:
      - "t"
    deps:
      - task: test_vars
        vars:
          TEST: $(date -Isec)
      - task: test_bool

  test_vars:
    desc: test about variables
    vars:
      TEST: $(date -I)
    cmds:
      - echo "now {{.TEST}}"

  test_bool:
    desc: test about bool vars
    vars:
      BOOL: true
    cmds:
      - echo {{.BOOL}}
      - echo ".BOOL" {{if .BOOL}}çœŸ{{else}}å½{{end}}
```

- deps ã«é…åˆ—æ¸¡ã—ã¦æ›¸ã‘ã°ã„ã„ã£ã¦ã‚ã‚‹ã‹ã‚‰ãã†ã™ã‚‹ã¨ã€æ¬¡ã®ã‚ˆã†ã«å€‹åˆ¥ã«ã¯ã†ã¾ãã„ããŒã€ä¾å­˜é–¢ä¿‚ï¼ˆtest_allï¼‰ã‚’å‡¦ç†ã•ã›ã‚‹ã¨å‡ºåŠ›ãŒãŠã‹ã—ã„

```bash
2024-06-04_task $ task test_bool
task: [test_bool] echo true
true
task: [test_bool] echo ".BOOL" çœŸ
.BOOL çœŸ
2024-06-04_task $ task test_vars
task: [test_vars] echo "now $(date -I)"
now 2024-06-04
2024-06-04_task $ task test_all
task: [test_bool] echo true
task: [test_vars] echo "now $(date -I)"
true
task: [test_bool] echo ".BOOL" çœŸ
.BOOL çœŸ
now 2024-06-04
```

- ä»–ã®éƒ¨åˆ†ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¾ãšã«ã‚ã‚Œã“ã‚Œè©¦ã—ãŸçµæœã€ãƒ–ãƒ­ã‚°ã®è¨˜äº‹ã«ã—ã‚ˆã†ã¨æº–å‚™ã‚’å§‹ã‚ãŸã‚‰æ­£è§£ã«ãŸã©ã‚Šç€ã
- å¾Œã§ã‚ã‹ã£ãŸã‘ã©ã€ä¾å­˜é–¢ä¿‚ã®ã‚¿ã‚¹ã‚¯ã¯é †åºã«é–¢ä¿‚ãªãä¸¦åˆ—ã§å‡¦ç†ã•ã‚Œã‚‹ï¼ˆã®ã§å‡ºåŠ›ã‚‚ãƒãƒ©ã‘ã‚‹ï¼‰
- ã›ã‚ã¦ã‚¿ã‚¹ã‚¯ã¨ã—ã¦ï¼‘ã‚»ãƒƒãƒˆãšã¤å‡ºã¦ãã‚Œã‚‹ãªã‚‰ã„ã„ã‘ã©ã€æ™‚é–“ã®ã‹ã‹ã‚‹ã‚¿ã‚¹ã‚¯ã¯ãƒ˜ãƒƒãƒ€ã¨å‡ºåŠ›ãŒé›¢ã‚Œã¦ã—ã¾ã†ã®ã§è¦‹ã«ãã„

# ä¾å­˜é–¢ä¿‚ã®é †ç•ªã‚’ç¶­æŒã—ãŸã„ï¼ˆansible ã® play ã®ã‚ˆã†ã«é †åºã‚ˆãå‡¦ç†ã•ã›ãŸã„ï¼‰

- [ä¾å­˜é–¢ä¿‚](https://taskfile.dev/usage/#task-dependencies) ã«ã¡ã‚ƒã‚“ã¨æ›¸ã„ã¦ã‚ã£ãŸ

> Dependencies run in parallel, so dependencies of a task should not depend one another.

- [åˆ¥ã®ã‚¿ã‚¹ã‚¯ã‚’å‘¼ã³å‡ºã™](https://taskfile.dev/usage/#calling-another-task) ã¨ã„ã†ã“ã¨ã§ã€cmds ã‚’ä½¿ã£ã¦é †ç•ªã«ã‚¿ã‚¹ã‚¯ã‚’å‘¼ã³å‡ºã›ã°ã„ã„ã‚‰ã—ã„

```bash
2024-06-04_task $ cat Taskfile.yml
# yaml-language-server: $schema=https://taskfile.dev/schema.json
# https://taskfile.dev/

version: '3'

tasks:
  test_all:
    desc: all test tasks
    aliases:
      - "t"
    cmds:  # ã“ã“ã ã‘é•ã†
      - task: test_vars
        vars:
          TEST: $(date -Isec)
      - task: test_bool

  test_vars:
    desc: test about variables
    vars:
      TEST: $(date -I)
    cmds:
      - echo "now {{.TEST}}"

  test_bool:
    desc: test about bool vars
    vars:
      BOOL: true
    cmds:
      - echo {{.BOOL}}
      - echo ".BOOL" {{if .BOOL}}çœŸ{{else}}å½{{end}}
```

```bash
2024-06-04_task $ task test_all
task: [test_vars] echo "now $(date -I)"
now 2024-06-04
task: [test_bool] echo true
true
task: [test_bool] echo ".BOOL" çœŸ
.BOOL çœŸ
```

- æœŸå¾…ã©ãŠã‚Šã®å‡ºåŠ›ã«ãªã£ãŸğŸ‰
- æ­£ç¢ºã«ã¯ã‚¿ã‚¹ã‚¯ã® vars ã‚’ä¸Šæ›¸ãã§ãã¦ãªã„ã‹ã‚‰åˆ¥ã®å•é¡ŒãŒæ®‹ã£ã¦ã„ã‚‹

# ã¾ã¨ã‚

- ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ä¸€å›ã¡ã‚ƒã‚“ã¨ç›®ã‚’é€šã™
  - ä»Šå›ã¯ dependency ã§æ¤œç´¢ã—ã¦ã€API ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ãŒå…ˆã«å‡ºã¦ãã¦ã€ä»–ã®ãƒšãƒ¼ã‚¸ã‚’è¦‹ãªã‹ã£ãŸã®ãŒæ‚ªã„
  - ä¾å­˜é–¢ä¿‚ï¼ˆdepsï¼‰ãŒé…åˆ—ã§è¡¨ç¾ã•ã‚Œã‚‹ãªã‚‰ã€ãã®é †åºã§å®Ÿè¡Œã•ã‚Œã‚‹ã¨æ€ã†ã˜ã‚ƒã‚“ï¼Ÿï¼ˆè¨€ã„è¨³ï¼‰
- examples çš„ãªè¨˜è¼‰ä¾‹ãŒã‚‚ã£ã¨ã‚ã‚‹ã¨ã„ã„ãªã€‚ã‚ã¨æ—¥æœ¬èªåŒ–
  - [Translating Taskfile to Japanese language - Crowdin](https://crowdin.com/project/taskfile/ja)
  - ä½¿ã„æ–¹ãŒã‚ã‹ã‚‰ãªã„ã—èª°ã‹æ—¢ã«ä½œæ¥­ã«å…¥ã£ã¦ã„ã‚‹ï¼Ÿ
  - examples ã¯è‡ªåˆ†ã§å‹æ‰‹ã«æ›¸ã“ã†
